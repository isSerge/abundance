<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Transactions &middot; Project Abundance</title>
  <meta name="title" content="Transactions &middot; Project Abundance" />
  
  <meta name="description" content="Initial work on transactions and other updates" />
  <meta name="keywords" content="status-update, " />
  
  
  <link rel="canonical" href="https://abundance.build/blog/2025-03-02-transactions/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.287e81a49537dedc21182f74fc776560c33aed47b54480f49953677d157ce68eca1a80b93a580cb53c88be89d90adf2b305d9018290a26139bef037d0c777c0f.css"
    integrity="sha512-KH6BpJU33twhGC90/HdlYMM67Ue1RID0mVNnfRV85o7KGoC5OlgMtTyIvonZCt8rMF2QGCkKJhOb7wN9DHd8Dw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.38829a2d46667b3048ed12a339f7a49584d39596241b4e61e344c689c257fec016f6e18ea8a349c0a7e2b35a3ef0ab2aed556a64100ada730fc9666da5b7c29a.js"
    integrity="sha512-OIKaLUZmezBI7RKjOfeklYTTlZYkG05h40TGicJX/sAW9uGOqKNJwKfis1o&#43;8Ksq7VVqZBAK2nMPyWZtpbfCmg==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:title" content="Transactions" />
<meta property="og:description" content="Initial work on transactions and other updates" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://abundance.build/blog/2025-03-02-transactions/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2025-03-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2025-03-02T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Transactions"/>
<meta name="twitter:description" content="Initial work on transactions and other updates"/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Blog",
    "name": "Transactions",
    "headline": "Transactions",
    "description": "Initial work on transactions and other updates",
    "abstract": "\u003cp\u003eThe most important progress from last week is initial work on transactions. I\u0026rsquo;ve spent quite some time thinking about\nthe design and even implemented an initial wallet contract alongside with related infrastructure.\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "https:\/\/abundance.build\/blog\/2025-03-02-transactions\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-03-02T00:00:00\u002b00:00",
    "datePublished": "2025-03-02T00:00:00\u002b00:00",
    
    "dateModified": "2025-03-02T00:00:00\u002b00:00",
    
    "keywords": ["status-update"],
    
    "mainEntityOfPage": "true",
    "wordCount": "1371"
  }]
  </script>


  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Project Abundance</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            

            


            


            
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            

            
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            

            </div>
        </label>
    </div>
</div>





  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Transactions
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  







  









  





<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2025-03-02T00:00:00&#43;00:00">2 March 2025</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">7 mins</span><span class="px-2 text-primary-500">&middot;</span>


  
  

<span class="mb-[2px]">
  <a
    href="https://github.com/nazar-pc/abundance/tree/main/website/main/content/blog/2025-03-02-transactions.md"
    class="text-lg hover:text-primary-500"
    rel="noopener noreferrer"
    target="_blank"
    title="Edit content"
    ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>
  </span>

</span></a
  >
</span>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/status-update/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    status-update
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

      

      
        
            
          
            
              
            
          
          
<div class="flex author author-extra mt-4">
  
      
      
        
        
          
        
        <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
          src="/3d67cc976284fd62356e2edd8a8dfc49_892901233448377679_hu5f5a137b03df0ac993fb782f4891c1fa_18416_192x192_fill_q75_box_center.jpg" />
      
  
  <div class="place-self-center">
    
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <a  href="https://abundance.build/authors/nazar-pc/"  class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      Nazar Mokrynskyi
    </a>
    
    
    <div class="text-2xl sm:text-lg">
      <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
        
        
        <a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="https://linkedin.com/in/nazarpc" target="_blank"
          aria-label="Linkedin" rel="me noopener noreferrer"><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</span></a>
        
        
        
        <a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="https://x.com/nazarpc" target="_blank"
          aria-label="X-Twitter" rel="me noopener noreferrer"><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>

</span></a>
        
        
        
        <a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="https://github.com/nazar-pc" target="_blank"
          aria-label="Github" rel="me noopener noreferrer"><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a>
        
        
        
        <a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="mailto:nazar@mokrynskyi.com" target="_blank"
          aria-label="Email" rel="me noopener noreferrer"><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a>
        
        
      </div>
    </div>
  </div>
</div>


      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
    

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          <p>The most important progress from last week is initial work on transactions. I&rsquo;ve spent quite some time thinking about
the design and even implemented an initial wallet contract alongside with related infrastructure.</p>
<p>As mentioned at the end of last week, adding a notion of transactions and explicit slots were the next steps and the
first part of that is now implemented in <a href="https://github.com/nazar-pc/abundance/pull/79" target="_blank">PR 79</a>, but first a bit of context.</p>
<p>As mentioned <a href="/book/Execution_environment/Contracts_overview.html">in the book</a>, &ldquo;Everything is a contract&rdquo; is the design philosophy for many things, and wallets are not an
exception here. This basically means that there is no &ldquo;system-wide&rdquo; notion way of a signature scheme to use for
transactions or even a way to serialize method calls into transaction payload. The wallet is just a contract that must
conform to some fairly generic interface. This interface should be flexible for all kinds of wallets: from simple ones
with a public key and nonce that checks a signature and supports simple transactions to complex multisig wallets, 2FA
support, support for whitelisting/blacklisting transactions depending on signer and a lot of other things I probably
can&rsquo;t think of right now. At the same time, contracts should compile to compact RISC-V binary and not require heap
allocation in most cases, ideally taking advantage of zero-copy mechanisms whenever possible.</p>
<p>As a result, I came with a trait that looks something like this (a bit simplified for this article):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">TransactionHeader</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">genesis_hash</span>: <span class="nc">Blake3Hash</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">block_hash</span>: <span class="nc">Blake3Hash</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">gas_limit</span>: <span class="nc">Gas</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">contract</span>: <span class="nc">Address</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">TxHandlerPayload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kt">u128</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">TxHandlerSeal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">TxHandler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="sd">/// Verify a transaction
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="cp">#[view]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">authorize</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">env</span>: <span class="kp">&amp;</span><span class="nc">Env</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">header</span>: <span class="kp">&amp;</span><span class="nc">TransactionHeader</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payload</span>: <span class="kp">&amp;</span><span class="nc">TxHandlerPayload</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">seal</span>: <span class="kp">&amp;</span><span class="nc">TxHandlerSeal</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">ContractError</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="sd">/// Execute previously verified transaction
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="w">    </span><span class="cp">#[update]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">execute</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">env</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Env</span><span class="o">&lt;</span><span class="nb">&#39;_</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">header</span>: <span class="kp">&amp;</span><span class="nc">TransactionHeader</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">payload</span>: <span class="kp">&amp;</span><span class="nc">TxHandlerPayload</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">seal</span>: <span class="kp">&amp;</span><span class="nc">TxHandlerSeal</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">ContractError</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><code>TxHandler::authorize()</code> takes transaction header, payload and seal and must make a decision whether to authorize
transaction or not. Authorization implies that the cost of gas limit will be charged before calling
<code>TxHandler::execute()</code> and the remainder will be returned after it.</p>
<p>Essentially, what we have is an interface that a node (transaction pool and execution environment) will be aware of to
statelessly verify the transaction for validity and stateful way to actually execute it. The contents of a transaction
payload is opaque to the execution environment (but has to be aligned to 16 bytes) just like seal is.</p>
<p>The payload canonically contains serialized method calls. Each wallet is allowed to implement it, whichever way it
wants, but there are some utilities in <code>ab-system-contract-simple-wallet-base</code> crate/contract that provide a reference
implementation of what it might look like. Specifically, that crate supports sequences of transactions and the ability
to reference outputs of previous transactions in transactions that follow, which is important for contract deployment,
for example.</p>
<p>The payload is aligned to the maximum alignment supported by <code>TrivialType</code> that is used for I/O between host and guest
with inputs, this way reference serialization/deserialization of method calls ensures all data structures are correctly
aligned in memory. Aligned data structures mean they don&rsquo;t need to be copied, the same bytes that were received from the
networking stack could be passed around as pointers and sliced into smaller data structures without allocating any more
memory dynamically.</p>
<p>The seal canonically contains something that authorizes the transaction, like a cryptographic signature and nonce to
prevent transaction replaying. <code>ab-system-contract-simple-wallet-base</code> literally has those, but one can have more than
one signature, some kind of one-time token instead of nonce and all kinds of other things imaginable.</p>
<p>Authorization here is a custom code and its execution is not guaranteed to be paid for, so how is it handled?</p>
<p>Well, with transaction signatures being a notion of the blockchain node, the same issue exists. So the answer here is
&ldquo;it depends,&rdquo; specifically node should be able to configure its own limit, but once the transaction is in the block,
inability to pay for it will make block invalid. It is expected that initially some low-ish limit will be set that is
enough to verify afew signatures, but it may be increased over time, including by node operator. This provides the
ultimate flexibility for contract developers while reducing the complexity of the node implementation.</p>
<p><code>ab-system-contract-simple-wallet-base</code> is also deployed as a system contract, containing the foundational logic, while
I also added <code>ab-contract-example-wallet</code> that demonstrates how to take advantage of it to have a compact and efficient
wallet contract.</p>


<h2 class="relative group">Hardware wallets 
    <div id="hardware-wallets" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#hardware-wallets" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I&rsquo;d like to dedicate a whole separate section for hardware wallets, especially in the context of recent <a href="https://x.com/Bybit_Official/status/1892965292931702929" target="_blank">ByBit hack</a>.</p>
<p>One of the first things in the design of contracts was the question of how to efficiently represent data structures in
serialized form. On the one hand, it is desirable to be able to pass data structures in zero-copy manner as much as
possible; on the other hand, there should be a way to make sense of them. This is why I initially reached to <code>zerocopy</code>
crate, which had tooling for this, but <a href="https://github.com/google/zerocopy/issues/2184" target="_blank">didn&rsquo;t have metadata generation</a> utilities like <a href="https://github.com/paritytech?q=scale&amp;language=rust" target="_blank">SCALE has</a>. I also looked at
<code>musli-zerocopy</code>, which was another promising candidate, but required a git awkward wrappers and still didn&rsquo;t solve the
metadata generation/parsing issue.</p>
<p>In the end, <a href="/rust-docs/ab_contracts_io_type/trivial_type/trait.TrivialType.html"><code>TrivialType</code></a> trait was born (implemented for types that can be treated as a bunch of bytes like <code>u8</code>,
<code>[u32; 4]</code>, etc.) and <a href="/rust-docs/ab_contracts_io_type/trait.IoType.html"><code>IoType</code></a> that is implemented for <code>TrivialType</code> and a few custom data structures. <code>TrivialType</code>
can be derived, and derived trait will contain <code>const METADATA</code>. This metadata can describe all kinds of data structure
shapes that can be passed between host and guest environment as &ldquo;bytes,&rdquo; meaning no serialization code is necessary,
just a pointer to existing memory.</p>
<p><a href="/rust-docs/ab_contracts_macros/attr.contract.html"><code>#[contract]</code></a> macro also implements metadata, but this time for the all methods, which includes data
structures involved too. As the result, all of this information is put into <code>ELF</code> section to be uploaded to the
blockchain together with the code and can be read by various tools.</p>
<p>There is a bunch of places that read the metadata to make sense of the data structures various methods expect. Execution
environment uses it to decode data structure received from one contract and to generate another data structure when
calling another. Similarly <code>ab-system-contract-simple-wallet-base</code> uses it to serialize/deserialize method calls to/from
payload bytes.</p>
<p>Going back to the hardware wallets and blind signing that lead to the hack, it would be possible to actually <strong>both
display and verify</strong> in somewhat human-readable format the contents of every transaction right on the hardware wallet
itself. Especially with wallets like <a href="https://shop.ledger.com/products/ledger-stax" target="_blank">Ledger Stax</a>, there is plenty of space to do so.</p>
<p>This is how it can be done:</p>
<ul>
<li>each transaction header contains both genesis hash and block hash for which transaction is signed</li>
<li>genesis hash is enough to know which blockchain transaction is signed for</li>
<li>from block hash it is possible to generate proofs about metadata of all the contracts involved in a particular
transaction</li>
<li>since hardware wallet can confirm what contract it is signing transaction for, it can also decode, display and verify
its contents, for example, with utilities provided by <code>ab-system-contract-simple-wallet-base</code></li>
</ul>
<p>As a result, there is no blind signing, no need to trust the UI or machine that the wallet is connected to.</p>
<p>For now the wallet would have to know which kind of wallet contract is used or else it&rsquo;ll not know how to deserialize
opaque <code>payload</code> (which is a price to pay for utmost flexibility of transaction format).</p>


<h2 class="relative group">Upcoming plans 
    <div id="upcoming-plans" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#upcoming-plans" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>There was a lot of preparation work and lower-level API changes done that led to the transaction interface, but I will
not bother readers with it this time because the blog post is fairly large as is.</p>
<p>As mentioned in the previous update, the next big step will be to integrate this into execution environment. And there
are many conveniences to add and paper-cuts to eliminate here and there, after which I&rsquo;ll be looking to do more
developer interviews.</p>
<p>Speaking about interviews, I had a technical interview with one of the candidates last week and hoping to have good news
to share next time.</p>
<p>This was one long blog post, if you made it till the end, thank you and see you next in about one more week!</p>
          
          
          
        </div>
        
        

        
        

          
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_blog\/2025-03-02-transactions.md"
        var oid_likes = "likes_blog\/2025-03-02-transactions.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.b06a29d42a4ed16787978e2eee1e8c797b7698db2bc14ccee78f5c80ac566fc996190a73ad80a5e987558474b20b96fa38f7d85b405f165ff72b7b163c5ad11b.js" integrity="sha512-sGop1CpO0WeHl44u7h6MeXt2mNsrwUzO549cgKxWb8mWGQpzrYCl6YdVhHSyC5b6OPfYW0BfFl/3K3sWPFrRGw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/blog/2025-02-21-5-million-flips/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >5 million flips</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-02-21T00:00:00&#43;00:00">21 February 2025</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/blog/2025-03-09-there-is-two-of-us-now/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >There is two of us now</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-03-09T00:00:00&#43;00:00">9 March 2025</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank" rel="license noopener noreferrer">CC0 1.0 Universal</a>
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js" integrity="sha512-YgYLskf03itt3kWQNmj&#43;&#43;2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script>
  
  
</footer>

  </div>
</body>

</html>
